% This document is designed to produce a french speaking report.

\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage[main=english]{babel}
\usepackage{url}
\usepackage{lastpage}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage[a4paper, margin=2cm, footskip=18.3pt]{geometry}
\usepackage{listings}
\usepackage{pdflscape}
\usepackage{color}

\newcommand{\header} {
    \setlength{\headheight}{30pt}\pagestyle{fancy}
    \fancyhead[L]{\includegraphics[height=20pt]{~/Templates/heig-logo}}\fancyhead[C]{PCO 2023\\ Lab 4}
    \fancyhead[R]{Timoth√©e Van Hove et Aubry Mangold\\\today}\fancyfoot[C]{}
    \fancyfoot[R]{Page \thepage~sur \pageref{LastPage}}\renewcommand{\footrulewidth}{0.3pt}
}

\lstset{frame=tb,
    language=C++,
    aboveskip=3mm,
    belowskip=3mm,
    showstringspaces=false,
    columns=flexible,
    basicstyle={\small\ttfamily},
    numbers=none,
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{blue},
    commentstyle=\color{dkgreen},
    stringstyle=\color{mauve},
    breaklines=true,
    breakatwhitespace=true,
    tabsize=3
}

\begin{document}
    \header


    \section{Introduction}

    The goal of this lab is to implement the management of a shared rail section in a train simulation.
    The source code of the simulator and a program boilerplate for the student program are provided.
    The simulator is a multithreaded program that simulates the behavior of a train on a rail network, leading to
    synchronization problems.
    The student program must implement the management of the shared rail section, the synchronization between the trains
    at the station and an emergency stop system.

    \section{Analysis}
% Talk about the problems arising from having two trains running on two threads that need to be synchoronized
%    Shared resources
%    Critical sections
%    Synchronization
%    Deadlocks

In a concurrent system where two trains are operated by separate threads, it is a synchronization challenge to ensure that both trains coexist in areas where their paths intersect or overlap (critical sections). Critical sections in this context include shared track sections and stations. The tracks, particularly the shared sections, act as shared resources. Without proper synchronization, both trains could attempt to occupy the same section simultaneously, leading to a collision in the simulation. Deadlocks are a significant risk. With two trains, this could occur if both attempt to enter the same shared section from opposite ends and wait indefinitely for the other to leave. Similar to shared sections, stations are points where special synchronization is needed. Both trains might need to use the station simultaneously.

    \section{Conception}
% Talk about how train blocks work in real life TIM: Really necessary?
% Talk about which concepts we've used to solve the problem
% Sections: shared section, station, emergency stop

To address station synchronization, we implemented a barrier mechanism. This ensures that trains can only leave the station when it is fully occupied. Additionally, we integrated a priority system within this barrier, giving precedence to the last train arriving at the station to depart first when the barrier is lifted.

For managing the shared section, we established a synchronization logic. This system ensures that while one train occupies this critical section, the other train waits. As soon as the first train exits the section, the waiting train receives clearance to enter. This approach effectively prevents conflicts and ensures safe passage through the shared track section.

    \section{Implementation}
% Briefly talk about the implementation, giving code examples where necessary


%Code listing
    \begin{lstlisting}
    \end{lstlisting}


    \section{Tests}

    \subsection*{Shared section}
% Describe the tests we've done to ensure the correctness of our implementation. This section is worth some points.
    - Run the provided train route
    - Run a route with the shared section right next to the station
    - Run a route with the shared section right before the station
    - Run a route with the share section separated from the station by a few blocks
    - Run a route with two shared sections
    - Run a route where there is only a station and a shared section

    \subsection*{Station synchronization}

    \subsection*{Emergency stop}

    \section{Conclusion}

    \appendix

    \section{Train routes}
    % images of the train routes used in the tests

\end{document}
